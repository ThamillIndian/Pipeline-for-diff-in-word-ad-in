<!DOCTYPE html>
<html>
<head>
    <title>Debug Your JSON Data</title>
</head>
<body>
    <h1>Testing Your JSON Data</h1>
    <div id="results"></div>

    <script>
        // Your actual JSON data - testing specific paragraphs with differences
        const testCases = [
            {
                paragraph: 10,
                input_with_markers: "People from Morocco in the Netherlands are generally referred to as Moroccans or Moroccan Dutch etc. However, people from Morocco may prefer to be referred to in other ways. For instance, people from the Berber<[sup]><[/sup]> minority may choose to be referred to as Amazigh or Moroccan Berber. Throughout the chapter, we will use Moroccan to refer to people originating from Morocco's geographical area and only make ethnic distinctions when relevant.",
                latest_edited_text: "<{body_text}> People from Morocco in the Netherlands are generally referred to as Moroccans or Moroccan Dutch, etc. However, people from Morocco may prefer to be referred to in other ways. For instance, people from the Berber<[sup]><[/sup]> minority may choose to be referred to as Amazigh or Moroccan Berber. Throughout the chapter, we will use Moroccan to refer to people originating from Morocco's geographical area and only make ethnic distinctions when relevant."
            },
            {
                paragraph: 11,
                input_with_markers: "Merkel's cells demonstrated an unusual response to Valium (diazepam), especially in white subjects compared to black subjects who recieved apples, pears and oranges. The Wassermann's test was also administered, alongside a Foley's catheter check. This phenomena is extremely important for understanding the disease's progression. Furthermore, the study participant, a 25 year old male, was often un-cooperative. In 1950 Doctor Smith first noted these observations.",
                latest_edited_text: "<{body_text}> Merkel cells demonstrated an unusual response to diazepam (Valium), especially in White subjects compared with Black subjects who received apples, pears, and oranges. The Wassermann test was also administered, alongside a Foley catheter check. This phenomenon is extremely important for understanding the disease's progression. Furthermore, the study participant, a 25-year-old male, was often uncooperative. In 1950 Doctor Smith first noted these observations."
            }
        ];

        // Simulate the removeMarkupTags function from your code
        function removeMarkupTags(text) {
            if (!text) return '';
            
            return text
                .replace(/<\{[^}]+\}>\s*/g, '') // Remove style tags like <{ch_head}>
                .replace(/<\[[^\]]+\]>/g, '') // Remove formatting tags like <[b]>, <[/b]>
                .replace(/\[[^\]]+\]/g, '') // Remove tags without angle brackets like [endash], [emdash]
                .trim();
        }

        let resultsHtml = '<h2>Debug Results:</h2>';

        testCases.forEach(testCase => {
            resultsHtml += `<h3>Paragraph ${testCase.paragraph}</h3>`;
            
            const originalText = removeMarkupTags(testCase.input_with_markers);
            const correctedText = removeMarkupTags(testCase.latest_edited_text);
            
            resultsHtml += `<p><strong>Raw input_with_markers:</strong><br><code>${testCase.input_with_markers.substring(0, 150)}...</code></p>`;
            resultsHtml += `<p><strong>Raw latest_edited_text:</strong><br><code>${testCase.latest_edited_text.substring(0, 150)}...</code></p>`;
            resultsHtml += `<p><strong>Cleaned Original:</strong><br><code>${originalText.substring(0, 150)}...</code></p>`;
            resultsHtml += `<p><strong>Cleaned Corrected:</strong><br><code>${correctedText.substring(0, 150)}...</code></p>`;
            resultsHtml += `<p><strong>Are they equal?</strong> ${originalText === correctedText}</p>`;
            resultsHtml += `<p><strong>Lengths:</strong> Original: ${originalText.length}, Corrected: ${correctedText.length}</p>`;
            
            if (originalText !== correctedText) {
                resultsHtml += '<p style="color: green;"><strong>✅ DIFFERENCES DETECTED!</strong></p>';
                
                // Find first difference
                for (let i = 0; i < Math.min(originalText.length, correctedText.length); i++) {
                    if (originalText[i] !== correctedText[i]) {
                        resultsHtml += `<p><strong>First difference at position ${i}:</strong></p>`;
                        resultsHtml += `<p>Original: "<code>${originalText.substring(Math.max(0, i-20), i+20)}</code>" (char: "${originalText[i]}" code: ${originalText.charCodeAt(i)})</p>`;
                        resultsHtml += `<p>Corrected: "<code>${correctedText.substring(Math.max(0, i-20), i+20)}</code>" (char: "${correctedText[i]}" code: ${correctedText.charCodeAt(i)})</p>`;
                        break;
                    }
                }
            } else {
                resultsHtml += '<p style="color: red;"><strong>❌ NO DIFFERENCES - This is the problem!</strong></p>';
            }
            
            resultsHtml += '<hr>';
        });

        document.getElementById('results').innerHTML = resultsHtml;
    </script>
</body>
</html>
