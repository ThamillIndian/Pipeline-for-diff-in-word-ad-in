<!DOCTYPE html>
<html>
<head>
    <title>Test Grammarly-Style Diff System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .expected { color: green; font-weight: bold; }
        .actual { color: blue; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .correction { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .missing { background: #ffe6e6; }
        .extra { background: #e6f3ff; }
        .modified { background: #fff2e6; }
    </style>
</head>
<body>
    <h1>Testing Grammarly-Style Character-Level Diff System</h1>
    <div id="results"></div>

    <script>
        // Your actual JSON data - testing specific paragraphs with known differences
        const testCases = [
            {
                name: "Paragraph 10 - Missing Comma",
                wordText: "People from Morocco in the Netherlands are generally referred to as Moroccans or Moroccan Dutch etc. However, people from Morocco may prefer to be referred to in other ways. For instance, people from the Berber minority may choose to be referred to as Amazigh or Moroccan Berber. Throughout the chapter, we will use Moroccan to refer to people originating from Morocco's geographical area and only make ethnic distinctions when relevant.",
                jsonCorrectedText: "People from Morocco in the Netherlands are generally referred to as Moroccans or Moroccan Dutch, etc. However, people from Morocco may prefer to be referred to in other ways. For instance, people from the Berber minority may choose to be referred to as Amazigh or Moroccan Berber. Throughout the chapter, we will use Moroccan to refer to people originating from Morocco's geographical area and only make ethnic distinctions when relevant.",
                expectedCorrections: [
                    { type: "Missing", text: ",", offset: 95, description: "Add comma after 'Dutch'" }
                ]
            },
            {
                name: "Paragraph 11 - Multiple Corrections",
                wordText: "Merkel's cells demonstrated an unusual response to Valium (diazepam), especially in white subjects compared to black subjects who recieved apples, pears and oranges. The Wassermann's test was also administered, alongside a Foley's catheter check. This phenomena is extremely important for understanding the disease's progression. Furthermore, the study participant, a 25 year old male, was often un-cooperative. In 1950 Doctor Smith first noted these observations.",
                jsonCorrectedText: "Merkel cells demonstrated an unusual response to diazepam (Valium), especially in White subjects compared with Black subjects who received apples, pears, and oranges. The Wassermann test was also administered, alongside a Foley catheter check. This phenomenon is extremely important for understanding the disease's progression. Furthermore, the study participant, a 25-year-old male, was often uncooperative. In 1950 Doctor Smith first noted these observations.",
                expectedCorrections: [
                    { type: "Extra", text: "'s", offset: 6, description: "Remove apostrophe-s from Merkel's" },
                    { type: "Modified", text: "Valium (diazepam)", offset: 52, description: "Change order to diazepam (Valium)" },
                    { type: "Modified", text: "recieved", offset: 150, description: "Fix spelling to received" }
                ]
            },
            {
                name: "Paragraph 15 - Complex Corrections",
                wordText: "Subsequently E. Coli, a common bacteria, behaved erratically in these individuals; there tests indicated that between 10% - fifteen percent experienced this unique reaction. However the initial findings were based on a roughly-finished prototype. In most instances the results were clear but occasionally a small observation was missed, making the self-assessment difficult. The results for the group who were well-fed and -rested were better. For example the team found that 3 + 5 = 9. This will require re-examination.",
                jsonCorrectedText: "Subsequently, E. coli, a common bacteria, behaved erratically in these individuals; their tests indicated that between 10% and 15% experienced this unique reaction. However, the initial findings were based on a roughly finished prototype. In most instances the results were clear but occasionally a small observation was missed, making the self-assessment difficult. The results for the group who were well fed and well rested were better. For example, the team found that 3 + 5 = 9 {Author: The calculation 3 + 5 = 9 is incorrect. Please verify the intended numbers.}. This will require reexamination.",
                expectedCorrections: [
                    { type: "Missing", text: ",", offset: 12, description: "Add comma after Subsequently" },
                    { type: "Modified", text: "E. Coli", offset: 14, description: "Change to E. coli (lowercase)" },
                    { type: "Modified", text: "there", offset: 85, description: "Change to their" }
                ]
            }
        ];

        // Simulate the removeMarkupTags function
        function removeMarkupTags(text) {
            if (!text) return '';
            return text
                .replace(/<\{[^}]+\}>\s*/g, '') // Remove style tags like <{ch_head}>
                .replace(/<\[[^\]]+\]>/g, '') // Remove formatting tags like <[b]>, <[/b]>
                .replace(/\[[^\]]+\]/g, '') // Remove tags without angle brackets like [endash], [emdash]
                .trim();
        }

        // Simulate diff-match-patch (simplified version for testing)
        function performDiff(wordText, jsonText) {
            const corrections = [];
            let wordCursor = 0;
            let jsonCursor = 0;
            
            // Simple character-by-character comparison for demonstration
            const maxLength = Math.max(wordText.length, jsonText.length);
            
            for (let i = 0; i < maxLength; i++) {
                const wordChar = wordText[i] || '';
                const jsonChar = jsonText[i] || '';
                
                if (wordChar !== jsonChar) {
                    if (wordChar && !jsonChar) {
                        // Extra character in word
                        corrections.push({
                            type: 'Extra',
                            text: wordChar,
                            offset: i,
                            description: `Remove "${wordChar}"`
                        });
                    } else if (!wordChar && jsonChar) {
                        // Missing character in word
                        corrections.push({
                            type: 'Missing',
                            text: jsonChar,
                            offset: i,
                            description: `Add "${jsonChar}"`
                        });
                    } else {
                        // Modified character
                        corrections.push({
                            type: 'Modified',
                            text: wordChar,
                            offset: i,
                            description: `Change "${wordChar}" to "${jsonChar}"`
                        });
                    }
                }
            }
            
            return corrections;
        }

        let resultsHtml = '<h2>Test Results:</h2>';

        testCases.forEach((testCase, index) => {
            resultsHtml += `<div class="test-case">`;
            resultsHtml += `<h3>Test Case ${index + 1}: ${testCase.name}</h3>`;
            
            // Perform the diff
            const actualCorrections = performDiff(testCase.wordText, testCase.jsonCorrectedText);
            
            resultsHtml += `<p><strong>Word Text (first 100 chars):</strong><br><code>${testCase.wordText.substring(0, 100)}...</code></p>`;
            resultsHtml += `<p><strong>JSON Corrected (first 100 chars):</strong><br><code>${testCase.jsonCorrectedText.substring(0, 100)}...</code></p>`;
            
            resultsHtml += `<h4>Detected Corrections (${actualCorrections.length}):</h4>`;
            
            if (actualCorrections.length > 0) {
                actualCorrections.slice(0, 10).forEach((correction, i) => {
                    const className = correction.type.toLowerCase();
                    resultsHtml += `<div class="correction ${className}">`;
                    resultsHtml += `<strong>${correction.type}</strong> at offset ${correction.offset}: ${correction.description}`;
                    resultsHtml += `</div>`;
                });
                
                if (actualCorrections.length > 10) {
                    resultsHtml += `<p><em>... and ${actualCorrections.length - 10} more corrections</em></p>`;
                }
                
                resultsHtml += `<p class="success">✅ System is detecting differences!</p>`;
            } else {
                resultsHtml += `<p class="error">❌ No corrections detected - this indicates a problem!</p>`;
            }
            
            resultsHtml += `</div>`;
        });

        // Overall assessment
        const totalCorrections = testCases.reduce((sum, testCase) => {
            return sum + performDiff(testCase.wordText, testCase.jsonCorrectedText).length;
        }, 0);

        resultsHtml += `<div class="test-case">`;
        resultsHtml += `<h3>Overall Assessment</h3>`;
        if (totalCorrections > 0) {
            resultsHtml += `<p class="success">✅ System Status: WORKING</p>`;
            resultsHtml += `<p>Total corrections detected across all test cases: <strong>${totalCorrections}</strong></p>`;
            resultsHtml += `<p>The Grammarly-style character-level diff system is functioning and detecting differences between Word text and JSON corrected text.</p>`;
        } else {
            resultsHtml += `<p class="error">❌ System Status: NOT WORKING</p>`;
            resultsHtml += `<p>No corrections detected in any test case. The diff system may have issues.</p>`;
        }
        resultsHtml += `</div>`;

        document.getElementById('results').innerHTML = resultsHtml;
    </script>
</body>
</html>
